<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EvacuAid</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevent scrolling on the entire page */
        }
        .bgimg {
            position: absolute;
        left: 0;
        width: 100%;
        height: 100%; 
        background-image: url('homebg1.jpg');
        background-size: cover; /* Ensures the image covers the entire area */
        background-repeat: no-repeat; /* Prevents the image from repeating */
        background-position: center; /* Centers the image */
        z-index: -1;
        }
        .navbar-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            z-index:1;

        }
        .home-button-container {
            position: absolute;
            top: 10px;
            left: 10px;
        }

        .home-button {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            color: white;
            text-decoration: none;
            font-size: 16x; /* Match the font size of the register button */
            background-color: #FFA500;
            padding: 18px; /* Match the padding of the register button */
            border-radius: 20px; /* Match the border radius of the register button */
            cursor: pointer;
            margin-top: 3px;
        }

        .home-button img {
            width: 25px; /* Slightly larger icon size for better visibility */
            height: 30px;
        }

        .home-button:hover {
            background-color: orange; /* Add hover effect similar to the register button */
            color: white;
        }
        
        
        .register-button {
            background-color: darkorange;
            color: white;
            border: none;
            padding: 25px 20px; /* Match the padding of the navbar links */
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            height: 100%; /* Match the height of the navbar */
            display: flex;
            align-items: center; /* Center the text vertically */
            justify-content: center; /* Center the text horizontally */
            box-sizing: border-box; /* Ensure padding is included in the height */
        }
        .register-button:hover {
            background: orange;
        }
        .register-button span {
            font-size: 12px;
            align-items: center;
            justify-content: center;
            flex-grow: 1;
        }
        .navbar {
            display: flex;
            justify-content: center;
            gap: 230px;
            border-radius: 50px;
            width: 1000px;
            text-align: center;
            background: linear-gradient(to bottom, #FFA500, darkorange);
            padding: 15px;
            margin-left: 20%;
        }
        .navbar a {
            color: white;
            text-decoration: none;
            padding: 14px 20px;
            text-align: center;
        }
        .navbar a:hover {
            background-color: #FFAD60;
            border-radius: 20px;
        }
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border-radius: 30px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            width: 400px;
            text-align: center; 
    }
        .modal input {
            display: block;
            width: 80%; 
            margin: 10px auto; 
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .modal button {
            background-color: darkorange;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        .modal button:hover {
            background-color: orange;
        }
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        .services-container {
            display: flex;
            justify-content: center;
            gap: 50px;
            margin: 50px 0;
            
        }
        .service-box {
            text-align: center;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 20px 20px rgba(0, 0, 0, 0.5); 
            
        }
        .service-box img {
            width: 400px;
            height: 400px;
            cursor: pointer;
            border-radius: 25px;
            
        }
        .service-box img:hover {
            transform: scale(1.1);
            transition: transform 0.3s;
        }
        .service-box p {
            margin-top: 10px;
            font-size: 18px;
            font-weight: bold;
        }
        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #333;
        }
        .close-button:hover {
            color: red;
        }
        #services, #contact, #profile {
            display: none;
        }
        /* Add this CSS rule to align the small tag */
        small {
            position: fixed;
            bottom: 10px;
            right: 10px;
            font-size: 12px;
            color: black;
            font-family: consolas, monospace;
        }
        /* Adjust layout for News and Updates and Weather Forecast */
        .home-content {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 20px;
            margin: 50px auto;
            width: 90%;
        }

        .container{
            display: flex;
            flex-direction: column;
            margin: 0 auto;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            margin-top: 20px;
            width: 50%;
        }

        .news-updates {
            flex: 1;
            height: 400px; /* Make it a square */
            background-color: darkorange;
            color: white;
            border: 1px solid white;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .news-updates h2 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .slider {
            width: 100%; /* Full width of the container */
            overflow: hidden; /* Hide overflowing images */
            border-radius: 10px;
            position: relative;
            height: 100%; /* Match the height of the container */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .slides {
            display: flex; /* Align images in a row */
            animation: scroll 20s linear infinite; /* Continuous scrolling animation */
            width: 100%; /* Full width of the slider */
            height: 100%; /* Match the height of the slider */
            display: flex;
        }

        .slides img {
            width: auto; /* Maintain the aspect ratio */
            height: 100%; /* Fit the height of the container */
            max-width: 100%; /* Ensure the image does not exceed the container width */
            object-fit: contain; /* Ensure the entire image is visible */
            margin: auto; /* Center the image */
        }

        @keyframes scroll {
            0% {
                transform: translateX(0);
            }
            100% {
                transform: translateX(-100%);
            }
        }

        .weather-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background-color: darkorange;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            z-index: 1000;
            margin-bottom: 30px; /* Adjust to ensure no gap */
        }

        .weather-widget:hover .weather-forecast-popup,
        .weather-forecast-popup:hover {
            display: block; /* Keep the popup visible when hovered */
        }

        .weather-icon img {
            width: 40px;
            height: 40px;
        }

        .weather-forecast-popup {
            display: none;
            position: absolute;
            bottom: 70px; /* Adjust to ensure no gap */
            right: 0;
            width: 250px;
            background: linear-gradient(to bottom, #f1e2c6, darkorange);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            padding: 15px;
            z-index: 1001;
            overflow-y: auto;
            max-height: 300px;
        }

        .weather-forecast-popup h2 {
            font-size: 18px;
            margin-bottom: 10px;
            color: darkorange;
            text-align: center;
        }

        .weather-forecast-popup .weather-info {
            font-size: 12px; /* Reduce font size */
            color: #ffffff;
            text-align: center;
        }

        .forecast-container {
            background: rgba(255, 255, 255, 0.9); /* Light background with slight transparency */
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            padding: 15px;
            margin-bottom: 10px; /* Space between containers */
            text-align: center;
            color: #333; /* Text color */
        }

        .forecast-container img {
            width: 50px;
            height: 50px;
            margin-top: 10px;
        }

        /* Dropdown container */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        /* Dropdown content (hidden by default) */
        .dropdown-content {
            display: none;
            position: absolute;
            top: 100%; /* Position below the button */
            left: 0;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            z-index: 1000;
            width: 150px;
            text-align: center;
        }

        /* Style for the dropdown items */
        .dropdown-content p {
            font-size: 14px;
            color: black;
            margin: 0;
            padding: 10px;
            border-bottom: 1px solid #ccc;
        }

        .dropdown-content .logout-button {
            background-color: rgb(255, 255, 255);
            color: white;
            border: none;
            padding: 10px;
            width: 100%;
            cursor: pointer;
            border-radius: 0 0 5px 5px;
            color: darkorange;
            font-size: 16px;
        }

        .dropdown-content .logout-button:hover {
            background-color: orange;
            color: white;
        }

        /* Show the dropdown on hover */
        .dropdown:hover .dropdown-content {
            display: block;
        }

        #welcome-label {
            font-size: 16px;
            color: white;
            margin-left: 10px;
            display: none; /* Hidden by default */
        }

        /* Profile Section */
        #profile {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.9); /* Light background */
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            margin: 20px auto;
            width: 80%;
        }

        #profile h1 {
            color: darkorange;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }

        #profile-info p {
            font-size: 16px;
            color: #333;
            margin: 10px 0;
            line-height: 1.5;
        }

        #edit-profile-button {
            background-color: darkorange;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin-top: 20px;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        #edit-profile-button:hover {
            background-color: orange;
            transform: scale(1.05);
        }

        /* Edit Profile Form */
        #edit-profile-form {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        #edit-profile-form form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        #edit-profile-form input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }

        #edit-profile-form button {
            background-color: darkorange;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        #edit-profile-form button:hover {
            background-color: orange;
            transform: scale(1.05);
        }

        #edit-profile-form button[type="button"] {
            background-color: #ccc;
            color: #333;
        }

        #edit-profile-form button[type="button"]:hover {
            background-color: #bbb;
        }

        /* Request List */
        #request-list {
            margin-top: 30px;
        }

        #request-list h2 {
            color: darkorange;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        #user-requests div {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #user-requests div p {
            margin: 5px 0;
            font-size: 14px;
            color: #555;
        }
    </style>
</head>
<body>
    <div class = "bgimg">
        
    </div>
    <!-- Home Button Outside Navbar -->
    <div class="home-button-container">
        <a href="javascript:void(0)" class="home-button" onclick="showSection('home')">
            <img src="home.jpg" alt="Home Icon"> 

        </a>
    </div>

    <div class="navbar-container">
        <div class="navbar-wrapper">
            <div class="navbar">
                <a href="javascript:void(0)" onclick="showSection('services')">Services</a>
                <a href="javascript:void(0)" onclick="showSection('contact')">Contact Us</a>
                <a href="javascript:void(0)" onclick="handleProfileClick(event)">Profile</a>
            </div>
        </div>
        <div class="user-actions">
            <div class="dropdown">
                <button class="register-button" id="user-button" onclick="toggleDropdown()">Register/Login</button>
                <span id="welcome-label" style="margin-left: 10px; font-size: 16px; color: white; display: none;">Hello, User</span>
                <div class="dropdown-content" id="dropdown-content">
                    <button class="logout-button" onclick="logoutUser()">Log Out</button>
                </div>
            </div>
        </div>
    </div>

    <div class="home" id="home">
        <div class="home-content">
            <!-- News and Updates Section -->
            <div class="news-updates">
                <h2>News and Updates</h2>
                <div class="slider">
                    <div class="slides" id="news-slides">
                        <!-- Uploaded images will be dynamically added here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="weather-widget">
        <div class="weather-icon">
            <img src="weatherwidget.png" alt="Weather Icon" />
        </div>
        <div class="weather-forecast-popup">
            <h2>Weather Forecast</h2>
            <div class="weather-info">
                <p>Loading weather data...</p>
            </div>
        </div>
    </div>

    <div id="loading-indicator" style="display: none;">
        <div class="loading-spinner"></div>
    </div>

    <div class="modal-overlay" id="modal-overlay" onclick="closeModal()"></div>
    <div class="modal" id="register-modal">
        <button class="close-button" onclick="closeModal()">&#10006;</button> 
        <h2>Register</h2>
        <form id="register-form" onsubmit="registerUser(event)">
            <input type="email" id="email" placeholder="Email" required>
            <input type="text" id="username" placeholder="Username" required>
            <input type="password" id="password" placeholder="Password" required>
            <button type="submit">Next</button>
        </form>

        
        <p>
            Already have an account? 
            <a href="#login-modal" onclick="openLoginModal()">Login here</a>
        </p>
    </div>

    <div class="modal" id="login-modal">
        <button class="close-button" onclick="closeModal()">&#10006;</button> 
        <h2>Login</h2>
        <form id="login-form" onsubmit="loginUser(event)">
            <input type="text" id="login-username" placeholder="Username or Email" required>
            <input type="password" id="login-password" placeholder="Password" required>
            <button type="submit">Login</button>
        </form>
    </div>
    <script>
    // Variable to track login status and user information
    let isLoggedIn = false;
    let currentUsername = "";
    const firebaseConfig = {
      apiKey: "AIzaSyBbgjSdS5rQPUAiMaRKnBp6M7_P3TnzKqY",
      authDomain: "evacuaid-51f47.firebaseapp.com",
      databaseURL: "https://evacuaid-51f47-default-rtdb.firebaseio.com",
      projectId: "evacuaid-51f47",
      storageBucket: "evacuaid-51f47.firebasestorage.app",
      messagingSenderId: "501712651017",
      appId: "1:501712651017:web:903db65f79fc2c034509d8",
      measurementId: "G-V1HLQZL3M7"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    // Function to register a user
    function registerUser(event) {
        event.preventDefault(); // Prevent form submission

        // Get form values
        const email = document.getElementById("email").value;
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;

        // Check if the fields are empty
        if (!email || !username || !password) {
            alert("All fields are required.");
            return;
        }

        // Check if the email or username already exists in the database
        firebase.database().ref("users").once("value").then((snapshot) => {
            let userExists = false;

            snapshot.forEach((childSnapshot) => {
                const userData = childSnapshot.val();

                if (userData.email === email) {
                    alert("This email is already registered.");
                    userExists = true;
                } else if (userData.username === username) {
                    alert("This username is already taken.");
                    userExists = true;
                }
            });

            if (userExists) {
                return; // Stop further execution if the user already exists
            }

            // If no match is found, proceed with registration
            const userId = firebase.database().ref().child("users").push().key; // Generate a unique key
            firebase.database().ref("users/" + userId).set({
                email: email,
                username: username,
                password: password // Note: Storing plain text passwords is insecure. Use Firebase Authentication for secure handling.
            }).then(() => {
                alert("Registration successful!");
                isLoggedIn = true; // Update login status
                currentUsername = username; // Store the username
                updateUI(); // Update the UI
                closeModal(); // Close the modal after successful registration
            }).catch((error) => {
                console.error("Error registering user:", error);
                alert("An error occurred. Please try again.");
            });
        }).catch((error) => {
            console.error("Error checking user existence:", error);
            alert("An error occurred. Please try again.");
        });
    }

    // Function to update the UI after login or logout
    function updateUI() {
        const registerButton = document.getElementById("user-button");
        const dropdownContent = document.getElementById("dropdown-content");

        if (isLoggedIn) {
            registerButton.innerHTML = `Hello, ${currentUsername} <span style="font-size: 18px;">&#9662;</span>`; // Add dropdown symbol
            dropdownContent.style.display = "none"; // Ensure dropdown is hidden by default
        } else {
            registerButton.textContent = "Register/Login"; // Reset the button text
            dropdownContent.style.display = "none"; // Hide dropdown when logged out
        }
    }

    // Function to open the register modal
    function openModal() {
        document.getElementById("register-modal").style.display = "block";
        document.getElementById("modal-overlay").style.display = "block";
    }

    // Function to close any modal
    function closeModal() {
        // Hide all modals and the overlay
        document.getElementById("register-modal").style.display = "none";
        document.getElementById("login-modal").style.display = "none";
        document.getElementById("modal-overlay").style.display = "none";

        // Clear the text fields in the login and register modal
        document.getElementById("login-username").value = "";
        document.getElementById("login-password").value = "";
        document.getElementById("email").value = "";
        document.getElementById("username").value = "";
        document.getElementById("password").value = "";
    }

    // Function to handle service clicks
    function handleServiceClick(event, serviceId) {
        if (!isLoggedIn) {
            event.preventDefault(); // Prevent the default link behavior
            alert("You need to register or log in to access this service.");
            openModal(); // Open the register modal
        } else {
            // Redirect to the service section
            window.location.href = serviceId;
        }
    }

    // Function to handle profile button click
    function handleProfileClick(event) {
        if (!isLoggedIn) {
            event.preventDefault(); // Prevent the default link behavior
            alert("You need to register or log in to access your profile.");
            openModal(); // Open the register modal
        } else {
            // Redirect to the profile section
            showSection('profile'); // Show the profile section
        }
    }

    // Function to open the login modal
    function openLoginModal() {
        closeModal(); // Close any open modals
        document.getElementById("login-modal").style.display = "block";
        document.getElementById("modal-overlay").style.display = "block";
    }

    // Function to log in a user
    function loginUser(event) {
        event.preventDefault(); // Prevent form submission

        const usernameOrEmail = document.getElementById("login-username").value;
        const password = document.getElementById("login-password").value;

        // Check the "admins" node for admin credentials
        firebase.database().ref("admins").once("value").then((snapshot) => {
            let isAdmin = false;

            snapshot.forEach((childSnapshot) => {
                const adminData = childSnapshot.val();

                if (adminData.username === usernameOrEmail && adminData.password === password) {
                    isAdmin = true;
                    alert("Welcome, Admin!");
                    window.location.href = "AdminRequestTab.html"; // Redirect to admin page
                }
            });

            if (!isAdmin) {
                // If not an admin, check the "users" node for regular user credentials
                firebase.database().ref("users").once("value").then((userSnapshot) => {
                    let userFound = false;

                    userSnapshot.forEach((childSnapshot) => {
                        const userData = childSnapshot.val();

                        if ((userData.username === usernameOrEmail || userData.email === usernameOrEmail) && userData.password === password) {
                            userFound = true;
                            isLoggedIn = true; // Update login status
                            currentUsername = userData.username; // Store the username
                            localStorage.setItem("isLoggedIn", true); // Save login state
                            localStorage.setItem("currentUsername", currentUsername); // Save username
                            alert(`Welcome back, ${currentUsername}!`);
                            updateUI(); // Update the UI
                            closeModal(); // Close the modal after successful login
                        }
                    });

                    if (!userFound) {
                        alert("Invalid username/email or password. Please try again.");
                    }
                }).catch((error) => {
                    console.error("Error checking user credentials:", error);
                    alert("An error occurred. Please try again.");
                });
            }
        }).catch((error) => {
            console.error("Error checking admin credentials:", error);
            alert("An error occurred. Please try again.");
        });
    }

    // Function to log out the user
    function logoutUser() {
        isLoggedIn = false; // Update login status
        currentUsername = ""; // Clear the username
        localStorage.removeItem("isLoggedIn"); // Clear login state
        localStorage.removeItem("currentUsername"); // Clear username
        updateUI(); // Update the UI
        alert("You have been logged out.");
        showSection('home'); // Redirect to the landing page
    }

    // Function to show the selected section and hide others
    function showSection(sectionId) {
        const sections = ['home', 'services', 'contact', 'profile'];
        sections.forEach(id => {
            const section = document.getElementById(id);
            if (section) {
                section.style.display = (id === sectionId) ? 'block' : 'none';
            }
        });

        // Load profile data if the profile section is shown
        if (sectionId === 'profile') {
            loadUserProfile();
            loadUserRequests(); // Load user requests
        }
    }

    // Function to fetch and display user profile information
    function loadUserProfile() {
        if (!isLoggedIn) {
            alert("You need to log in to view your profile.");
            openModal(); // Redirect to the registration modal
            return;
        }

        // Fetch user data from Firebase
        firebase.database().ref("users").once("value").then((snapshot) => {
            let userFound = false;

            snapshot.forEach((childSnapshot) => {
                const userData = childSnapshot.val();

                // Match the current logged-in user
                if (userData.username === currentUsername) {
                    userFound = true;

                    // Populate the profile section
                    const profileInfo = document.getElementById("profile-info");
                    profileInfo.innerHTML = `
                        <p><strong>Full Name:</strong> ${userData.fullName || "Not provided"}</p>
                        <p><strong>Birthday:</strong> ${userData.birthday || "Not provided"}</p>
                        <p><strong>Phone Number:</strong> ${userData.phone || "Not provided"}</p>
                        <p><strong>Email:</strong> ${userData.email}</p>
                        <p><strong>Home Address:</strong> ${userData.address || "Not provided"}</p>
                    `;
                }
            });

            if (!userFound) {
                alert("User profile not found.");
            }
        }).catch((error) => {
            console.error("Error fetching user profile:", error);
            alert("An error occurred while loading your profile.");
        });
    }

    // Function to toggle between viewing and editing profile
    function toggleEditProfile() {
        const profileInfo = document.getElementById("profile-info");
        const editProfileForm = document.getElementById("edit-profile-form");
        const editButton = document.getElementById("edit-profile-button");

        if (editProfileForm.style.display === "none") {
            // Switch to editing mode
            editProfileForm.style.display = "block";
            profileInfo.style.display = "none";
            editButton.textContent = "Cancel";

            // Pre-fill the form with current profile data
            firebase.database().ref("users").once("value").then((snapshot) => {
                snapshot.forEach((childSnapshot) => {
                    const userData = childSnapshot.val();
                    if (userData.username === currentUsername) {
                        document.getElementById("edit-fullName").value = userData.fullName || "";
                        document.getElementById("edit-birthday").value = userData.birthday || "";
                        document.getElementById("edit-phone").value = userData.phone || "";
                        document.getElementById("edit-email").value = userData.email || "";
                        document.getElementById("edit-address").value = userData.address || "";
                    }
                });
            });
        } else {
            // Switch to viewing mode
            editProfileForm.style.display = "none";
            profileInfo.style.display = "block";
            editButton.textContent = "Edit Profile";
        }
    }

    // Function to save updated profile information
    function saveProfile(event) {
        event.preventDefault(); // Prevent form submission

        // Get updated values from the form
        const fullName = document.getElementById("edit-fullName").value;
        const birthday = document.getElementById("edit-birthday").value;
        const phone = document.getElementById("edit-phone").value;
        const address = document.getElementById("edit-address").value;

        // Update the user's profile in Firebase
        firebase.database().ref("users").once("value").then((snapshot) => {
            snapshot.forEach((childSnapshot) => {
                const userId = childSnapshot.key;
                const userData = childSnapshot.val();

                if (userData.username === currentUsername) {
                    firebase.database().ref("users/" + userId).update({
                        fullName: fullName,
                        birthday: birthday,
                        phone: phone,
                        address: address
                    }).then(() => {
                        alert("Profile updated successfully!");
                        toggleEditProfile(); // Switch back to viewing mode
                        loadUserProfile(); // Reload the profile information
                    }).catch((error) => {
                        console.error("Error updating profile:", error);
                        alert("An error occurred while updating your profile.");
                    });
                }
            });
        });
    }

    // Function to fetch and display user requests
    function loadUserRequests() {
        const userName = localStorage.getItem("currentUsername"); // Get the logged-in user's username
        if (!userName) {
            alert("You must be logged in to view your requests.");
            return;
        }

        const requestList = document.getElementById("user-requests");
        requestList.innerHTML = "<p>Loading your requests...</p>";

        database.ref("requests").orderByChild("userName").equalTo(userName).on("value", (snapshot) => {
            if (!snapshot.exists()) {
                requestList.innerHTML = "<p>No requests found.</p>";
                return;
            }

            let requestsHTML = "";
            snapshot.forEach((childSnapshot) => {
                const request = childSnapshot.val();
                requestsHTML += `
                    <div style="border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 5px;">
                        <p><strong>Request ID:</strong> ${childSnapshot.key}</p>
                        <p><strong>Form Type:</strong> ${request.formType}</p>
                        <p><strong>Status:</strong> ${request.status}</p>
                    </div>
                `;
            });
            requestList.innerHTML = requestsHTML;
        });
    }

    // Function to load news images from Firebase
    function loadNewsImages() {
        const slidesContainer = document.getElementById('news-slides');
        slidesContainer.innerHTML = '<p>Loading images...</p>'; // Show a loading message

        firebase.database().ref('news-images').on('value', (snapshot) => {
            if (!snapshot.exists()) {
                slidesContainer.innerHTML = '<p>No news images available.</p>';
                return;
            }

            let slidesHTML = '';
            snapshot.forEach((childSnapshot) => {
                const imageData = childSnapshot.val();
                slidesHTML += `<img src="${imageData.url}" alt="${imageData.name}" style="width: 100%; height: 100%; object-fit: cover;">`;
            });

            slidesContainer.innerHTML = slidesHTML; // Add the images to the slider
        });
    }

    // Load login state on page load
    document.addEventListener('DOMContentLoaded', () => {
        const savedLoginState = localStorage.getItem("isLoggedIn");
        const savedUsername = localStorage.getItem("currentUsername");
        if (savedLoginState === "true" && savedUsername) {
            isLoggedIn = true;
            currentUsername = savedUsername;
        }
        updateUI();
        showSection('home');

        // JavaScript for the image slider
        const slides = document.querySelector('.slides');
        let index = 0;

        function showNextSlide() {
            const images = document.querySelectorAll('.slides img');
            if (images.length === 0) return; // Exit if no images are loaded

            index = (index + 1) % images.length; // Loop back to the first image after the last one
            slides.style.transform = `translateX(-${index * 100}%)`; // Slide to the next image
        }

        setInterval(showNextSlide, 3000); // Change image every 3 seconds

        // JavaScript to fetch and display weather data
        const weatherInfo = document.querySelector('.weather-info');

        // WeatherAPI details
        const apiKey = '0a7536f405db43fbb74110022250105'; // Replace with your WeatherAPI key
        const latitude = '14.634583305097465'; // Latitude of Barangay Tañong
        const longitude = '121.08580105303164'; // Longitude of Barangay Tañong
        const apiUrl = `https://api.weatherapi.com/v1/forecast.json?key=${apiKey}&q=${latitude},${longitude}&days=3&aqi=no&alerts=no`;

        fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
                const { current, forecast } = data;

                // Override the location name to "Tañong, Marikina City"
                const locationName = "Barangay Tañong, Marikina City";

                // Display current weather
                let weatherHTML = `
                    <h3>Current Weather</h3>
                    <div class="forecast-container">
                        <p><strong>Location:</strong> ${locationName}</p>
                        <p><strong>Temperature:</strong> ${current.temp_c}°C</p>
                        <p><strong>Condition:</strong> ${current.condition.text}</p>
                        <img src="https:${current.condition.icon}" alt="Weather Icon">
                    </div>
                `;

                // Display 3-day forecast
                weatherHTML += `<h3>3-Day Forecast</h3>`;
                forecast.forecastday.forEach(day => {
                    weatherHTML += `
                        <div class="forecast-container">
                            <p><strong>Date:</strong> ${day.date}</p>
                            <p><strong>Max Temp:</strong> ${day.day.maxtemp_c}°C</p>
                            <p><strong>Min Temp:</strong> ${day.day.mintemp_c}°C</p>
                            <p><strong>Condition:</strong> ${day.day.condition.text}</p>
                            <img src="https:${day.day.condition.icon}" alt="Weather Icon">
                        </div>
                    `;
                });

                weatherInfo.innerHTML = weatherHTML;
            })
            .catch(error => {
                console.error('Error fetching weather data:', error);
                weatherInfo.innerHTML = '<p>Unable to load weather data. Please try again later.</p>';
            });

        // Load news images
        loadNewsImages();
    });

    document.addEventListener('DOMContentLoaded', () => {
        const weatherWidget = document.querySelector('.weather-widget');
        const weatherPopup = document.querySelector('.weather-forecast-popup');

        let isHovering = false;

        // Show the popup when the widget is hovered
        weatherWidget.addEventListener('mouseenter', () => {
            isHovering = true;
            weatherPopup.style.display = 'block';
        });

        // Keep the popup visible when hovered
        weatherPopup.addEventListener('mouseenter', () => {
            isHovering = true;
            weatherPopup.style.display = 'block';
        });

        // Hide the popup when the cursor leaves both the widget and the popup
        weatherWidget.addEventListener('mouseleave', () => {
            setTimeout(() => {
                if (!isHovering) {
                    weatherPopup.style.display = 'none';
                }
            }, 100); // Small delay to account for quick transitions
        });

        weatherPopup.addEventListener('mouseleave', () => {
            isHovering = false;
            setTimeout(() => {
                if (!isHovering) {
                    weatherPopup.style.display = 'none';
                }
            }, 100); // Small delay to account for quick transitions
        });
    });

    function toggleDropdown() {
        if (isLoggedIn) {
            const dropdownContent = document.getElementById("dropdown-content");
            dropdownContent.style.display = dropdownContent.style.display === "block" ? "none" : "block";
        } else {
            openModal(); // Open the registration modal if the user is not logged in
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        loadNewsImages();

        const slides = document.querySelector('.slides');
        let index = 0;

        function showNextSlide() {
            const images = document.querySelectorAll('.slides img');
            if (images.length === 0) return; // Exit if no images are loaded

            index = (index + 1) % images.length; // Loop back to the first image after the last one
            slides.style.transform = `translateX(-${index * 100}%)`; // Slide to the next image
        }

        setInterval(showNextSlide, 3000); // Change image every 3 seconds
    });
    </script>

<div id="services">
    <div class="services-container">
        <div class="service-box">
            <a href="Documents.html" onclick="handleServiceClick(event, '#barangay-services')">
                <img src="documents.png" alt="Barangay Services"> 
            </a>
            <p>Barangay Services</p>
        </div>
        <div class="service-box">
            <a href="EmergencyServices.html">
                <img src="emergency.png" alt="Emergency Services">
            </a>
            <p>Emergency Services</p>
        </div>
    </div>
</div>
    <div id="contact">
        <div class="container">
            <h1>Contact Us</h1>
            <p>
                <img src="email-icon.png" alt="Email Icon" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 10px;">
                <strong>Email:</strong> barangaytanongcouncil@gmail.com
            </p>
            <p>
                <img src="facebook-icon.png" alt="Facebook Icon" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 10px;">
                <strong>Facebook Page:</strong> <a href="https://www.facebook.com/profile.php?id=61553549227340" target="_blank">Barangay Tañong Council</a>
            </p>
            <p>
                <img src="hotline-icon.png" alt="Hotline Icon" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 10px;">
                <strong>Hotline:</strong> 02 85253037
            </p>
        </div>
    </div>
    <div id="profile">
        <div class="container">
            <h1>Profile</h1>
            <div id="profile-info">
                <p>Loading profile information...</p>
            </div>
            <button id="edit-profile-button" onclick="toggleEditProfile()">Edit Profile</button>
            <div id="edit-profile-form" style="display: none;">
                <form onsubmit="saveProfile(event)">
                    <input type="text" id="edit-fullName" placeholder="Full Name">
                    <input type="date" id="edit-birthday" placeholder="Birthday">
                    <input type="text" id="edit-phone" placeholder="Phone Number">
                    <input type="email" id="edit-email" placeholder="Email" disabled>
                    <input type="text" id="edit-address" placeholder="Home Address">
                    <button type="submit">Save</button>
                    <button type="button" onclick="toggleEditProfile()">Cancel</button>
                </form>
            </div>
            <div id="request-list" style="margin-top: 20px;">
                <h2>Your Requests</h2>
                <div id="user-requests">
                    <p>Loading your requests...</p>
                </div>
            </div>
        </div>
    </div>

    <b><small>All rights reserved.</small></b>
    
</body>
</html>
`


